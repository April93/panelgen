<html>
<style>
body
{
	background-color: grey;
}
div
{
	width: 192px;
	border-style: double;
	border-color: #0000FF;
}
img
{
	width: 32px;
}
</style>
<center>
<body>
	<h1>Discord Panel Generator</h1>
	<div id="field">
		<img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=12 column="1"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=12 column="2"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=12 column="3"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=12 column="4"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=12 column="5"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=12 column="6"/><br>
		<img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=11 column="1"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=11 column="2"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=11 column="3"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=11 column="4"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=11 column="5"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=11 column="6"/><br>
		<img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=10 column="1"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=10 column="2"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=10 column="3"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=10 column="4"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=10 column="5"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=10 column="6"/><br>
		<img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=9 column="1"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=9 column="2"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=9 column="3"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=9 column="4"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=9 column="5"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=9 column="6"/><br>
		<img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=8 column="1"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=8 column="2"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=8 column="3"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=8 column="4"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=8 column="5"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=8 column="6"/><br>
		<img onclick="drawpanel(this)" ondragover="draw(this)" src="images/sl.png" row=7 column="1"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/sm.png" row=7 column="2"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/sm.png" row=7 column="3"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/sm.png" row=7 column="4"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/sm.png" row=7 column="5"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/sr.png" row=7 column="6"/><br>
		<img onclick="drawpanel(this)" ondragover="draw(this)" src="images/gl.png" row=6 column="1"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/gf.png" row=6 column="2"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/gr.png" row=6 column="3"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=6 column="4"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=6 column="5"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=6 column="6"/><br>
		<img onclick="drawpanel(this)" ondragover="draw(this)" src="images/cr.png" row=5 column="1"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/cc.png" row=5 column="2"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/cg.png" row=5 column="3"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/cy.png" row=5 column="4"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/cp.png" row=5 column="5"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/cb.png" row=5 column="6"/><br>
		<img onclick="drawpanel(this)" ondragover="draw(this)" src="images/pr.png" row=4 column="1"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/pc.png" row=4 column="2"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/pg.png" row=4 column="3"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/py.png" row=4 column="4"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/pp.png" row=4 column="5"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/pb.png" row=4 column="6"/><br>
		<img onclick="drawpanel(this)" ondragover="draw(this)" src="images/pr.png" row=3 column="1"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/pc.png" row=3 column="2"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/pg.png" row=3 column="3"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/py.png" row=3 column="4"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/pp.png" row=3 column="5"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/pb.png" row=3 column="6"/><br>
		<img onclick="drawpanel(this)" ondragover="draw(this)" src="images/pr.png" row=2 column="1"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/pc.png" row=2 column="2"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/pg.png" row=2 column="3"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/py.png" row=2 column="4"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/pp.png" row=2 column="5"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/pb.png" row=2 column="6"/><br>
		<img onclick="drawpanel(this)" ondragover="draw(this)" src="images/pr.png" row=1 column="1"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/pc.png" row=1 column="2"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/pg.png" row=1 column="3"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/py.png" row=1 column="4"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/pp.png" row=1 column="5"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/pb.png" row=1 column="6"/>
	</div>
	<br>
	<div id="tileset">
		<img onclick="selpanel(this)" src="images/gtl.png" paneltype="garbage"/><img onclick="selpanel(this)" src="images/gtr.png" paneltype="garbage"/><img onclick="selpanel(this)" src="images/gbl.png" paneltype="garbage"/><img onclick="selpanel(this)" src="images/gbr.png" paneltype="garbage"/>
        <img onclick="selpanel(this)" src="images/gl.png"/><img onclick="selpanel(this)" src="images/fl.png"/><img onclick="selpanel(this)" src="images/fr.png"/><img onclick="selpanel(this)" src="images/gm.png"/><img onclick="selpanel(this)" src="images/gf.png"/><img onclick="selpanel(this)" src="images/gr.png"/><br>
		<img onclick="selpanel(this)" src="images/pr.png"/><img onclick="selpanel(this)" src="images/pc.png"/><img onclick="selpanel(this)" src="images/pg.png"/><img onclick="selpanel(this)" src="images/py.png"/><img onclick="selpanel(this)" src="images/pp.png"/><img onclick="selpanel(this)" src="images/pb.png"/><br>
		<img onclick="selpanel(this)" src="images/ps.png"/><img onclick="selpanel(this)" src="images/po.png"/><img onclick="selpanel(this)" src="images/px.png"/><img onclick="selpanel(this)" src="images/sl.png"/><img onclick="selpanel(this)" src="images/sm.png"/><img onclick="selpanel(this)" src="images/sr.png"/><br>
		<img onclick="selpanel(this)" src="images/cr.png"/><img onclick="selpanel(this)" src="images/cc.png"/><img onclick="selpanel(this)" src="images/cg.png"/><img onclick="selpanel(this)" src="images/cy.png"/><img onclick="selpanel(this)" src="images/cp.png"/><img onclick="selpanel(this)" src="images/cb.png"/><br>
		<img onclick="selpanel(this)" src="images/co.png"/><img onclick="selpanel(this)" src="images/xx.png"/><img onclick="selpanel(this)" src="images/xx.png"/><img onclick="selpanel(this)" src="images/xx.png"/><img onclick="selpanel(this)" src="images/xx.png"/><img onclick="selpanel(this)" src="images/xx.png"/>
	</div>
	<br>
	Whitespace:<input type="checkbox" id="whitespace"><br>
	<button onclick="clearpanels()">Clear</button><button onclick="discord()">Discord</button>
	<br><button onclick="panelattack()">Panel Atack</button>
	<div>
		<textarea id="discordtext"></textarea>
	</div>
	<button onclick="loadset()">Load</button>
</body>
</center>
</html>
<script>
var selectedpanel = document.getElementById("tileset").firstElementChild
var lastImgBelowMouse

document.addEventListener('mousemove', updateElementBelowMouse)

function updateElementBelowMouse(event)
{
    var element = document.elementFromPoint(event.clientX, event.clientY);
    if (element.nodeName.toLowerCase() === 'img' && element.parentNode.getAttribute('id') === 'field')
    {
        lastImgBelowMouse = element
    }
}
function draw(img)
{
    if (selectedpanel.getAttribute('panelType') === "garbage")
    {
        if (!lastImgBelowMouse)
        {
            lastImgBelowMouse = img
        }
        drawgarbage(img)
    }
    else
    {
        drawpanel(img)
    }
}
function drawgarbage(img)
{
    //get the coordinate from the panel we are on right now
    //calculate width + height of the garbage by doing a diff with the panel where we started dragging
    var anchor1X = Number(img.getAttribute('column'))
    var anchor1Y = Number(img.getAttribute('row'))
    console.log("anchor1 at " + anchor1Y + "|" + anchor1X);
    var anchor2X = Number(lastImgBelowMouse.getAttribute('column'))
    var anchor2Y = Number(lastImgBelowMouse.getAttribute('row'))
    console.log("anchor2 at " + anchor2Y + "|" + anchor2X);
    var garbageHeight = Math.abs(anchor1Y - anchor2Y) + 1
    var garbageWidth = Math.abs(anchor1X - anchor2X) + 1
    console.log("garbage dimensions are " + garbageWidth + "x" + garbageHeight);
    var topLeftAnchor = getTopLeftAnchorOfBox(anchor1X, anchor1Y, anchor2X, anchor2Y)
    var bottomRightAnchor = getBottomRightAnchorOfBox(topLeftAnchor, garbageWidth - 1, garbageHeight - 1)
    console.log("topLeftAnchor is " + topLeftAnchor.row + "|" + topLeftAnchor.column)
    console.log("bottomRightAnchor is " + bottomRightAnchor.row + "|" + bottomRightAnchor.column)

    var splitFaceHorizontally = garbageHeight % 2 === 0
    var splitFaceVertically = garbageWidth % 2 === 0
    //var faceAnchor;
    //faceAnchor.X = topLeftAnchor.X - 0.5 + garbageWidth / 2.0;
    //faceAnchor.Y = topLeftAnchor + 0.5 + garbageHeight / 2.0;
    // let's ignore the face for starters

    if (garbageHeight > 2) 
    {   // 4 corner tiles and onesided walls
        // by convention always draw rowwise from top left to bottom right
        for (var row = topLeftAnchor.row; row >= bottomRightAnchor.row; row--) 
        {
            for (var column = topLeftAnchor.column; column <= bottomRightAnchor.column; column++)
            {
                var element = document.querySelector("[row='" + row + "'][column='" + column + "']");
                console.log("About to draw element at " + row + "|" + column);
                if (row === topLeftAnchor.row)
                {
                    if (column === topLeftAnchor.column)
                    {   // draw top left corner tile
                        element.src = "images/gtl.png";
                    }
                    else if (column === bottomRightAnchor.column)
                    {   // draw top right corner tile
                        element.src = "images/gtr.png";
                    }
                    else
                    {   // draw top edge tile
                        element.src = "images/gts.png";
                    }
                }
                else if (row === bottomRightAnchor.row)
                {
                    if (column === topLeftAnchor.column)
                    {   // draw bottom left corner tile
                        element.src = "images/gbl.png";
                    }
                    else if (column === bottomRightAnchor.column)
                    {   // draw bottom right corner tile
                        element.src = "images/gbr.png";
                    }
                    else
                    {   // draw bottom edge tile
                        element.src = "images/gbs.png";
                    }
                }
                else
                {
                    if (column === topLeftAnchor.column)
                    {   // draw left edge tile
                        element.src = "images/gls.png";
                    }
                    else if (column === bottomRightAnchor.column)
                    {   // draw right edge tile
                        element.src = "images/grs.png";
                    }
                    else
                    {   // draw filler tile
                        element.src = "images/ge.png";
                    }
                }
            }
        }
    }
    else
    {   // 2 side tiles and twosided walls
        for (var column = topLeftAnchor.column; column <= bottomRightAnchor.column; column++)
        {
            console.log("About to draw element at " + topLeftAnchor.row + "|" + column);
            var element = document.querySelector("[row='"+topLeftAnchor.row+"'][column='"+column+"']");
            if (column === topLeftAnchor.column)
            {   // draw left side tile
                if (column === bottomRightAnchor.column)
                {   // 1x1 tile, draw 4-sided tile
                    element.src = "images/g4s.png";
                }
                else
                {
                    element.src = "images/gl.png";
                }
            }
            else if (column === bottomRightAnchor.column)
            {   // draw right side tile
                element.src = "images/gr.png";
            }
            else
            {   // draw top/bottom edge tile
                if (splitFaceVertically && (1 + column - topLeftAnchor.column === garbageWidth / 2))
                {
                    element.src = "images/fl.png";
                }
                else if (splitFaceVertically && (column - topLeftAnchor.column === garbageWidth / 2))
                {
                    element.src = "images/fr.png";
                }
                else if (!splitFaceVertically && column - topLeftAnchor.column + 1 === (garbageWidth + 1) / 2)
                {
                    element.src = "images/gf.png";
                }
                else
                {
                    element.src = "images/gm.png";
                }
            }
        }
    }
}

function getTopLeftAnchorOfBox(anchor1X, anchor1Y, anchor2X, anchor2Y)
{
    var topLeftAnchor = new Vector([0, 0]);

    topLeftAnchor.column = Math.min(anchor1X, anchor2X);
    topLeftAnchor.row = Math.max(anchor1Y, anchor2Y);

    return topLeftAnchor;
}
function getBottomRightAnchorOfBox(topLeftAnchor, width, height)
{
    return new Vector([topLeftAnchor.row - height, topLeftAnchor.column + width]);
}
function drawpanel(img)
{
    img.src = selectedpanel.src
}
function selpanel(img)
{
	selectedpanel = img
}
function clearpanels()
{
	var children = document.getElementById('field').getElementsByTagName('img');
	for( var i = 0; i<children.length; i++)
	{
		children[i].src = "images/xx.png"
	}
}
function discord()
{
	var gentext = ""
	var children = document.getElementById('field').getElementsByTagName('img');

	var linecount = 0;
	var line = ""
	for( var i = 0; i<children.length; i++)
	{
	    line += ":"+children[i].src.substr(children[i].src.length - 6, 2)+":"
	    linecount += 1;
	    if(linecount >= 6)
	    {
	    	linecount = 0;

	    	if(document.getElementById("whitespace").checked == false)
	    	{
	    		while(line.substr(line.length - 4, 4) == ":xx:")
	    		{
	    			line = line.substr(0,line.length-4)
	    		}
	    	}
	    	if(line.length != 0 && i <= 66)
	    		line += "\n"
	    	gentext += line
	    	line = ""
		}
	}
	document.getElementById("discordtext").value = gentext
}
function panelattack()
{
/*
0 = empty
1 = red
2 = green
3 = light blue
4 = yellow
5 = purple
6 = dark blue
7 = orange (not really used in the game so far, but it exists)
8 = exclamation block [!]
9 = block with no color (dark grey, doesn't match with anything)
[] = garbage start / end
{} = metal garbage start / end
= = placeholder inside of garbage
*/
	var gentext = ""
	var children = document.getElementById('field').getElementsByTagName('img');
	for( var i = 0; i<children.length; i++)
	{
	    gentext += ":"+children[i].src.substr(children[i].src.length - 6, 2)+":"
	    gentext = gentext.replace(":xx:", "0");
	    gentext = gentext.replace(":pr:", "1");
	    gentext = gentext.replace(":cr:", "1");
	    gentext = gentext.replace(":pg:", "2");
	    gentext = gentext.replace(":cg:", "2");
	    gentext = gentext.replace(":pc:", "3");
	    gentext = gentext.replace(":cc:", "3");
	    gentext = gentext.replace(":py:", "4");
	    gentext = gentext.replace(":cy:", "4");
	    gentext = gentext.replace(":pp:", "5");
	    gentext = gentext.replace(":cp:", "5");
	    gentext = gentext.replace(":pb:", "6");
	    gentext = gentext.replace(":cb:", "6");
	    gentext = gentext.replace(":po:", "7");
	    gentext = gentext.replace(":co:", "7");
	    gentext = gentext.replace(":ps:", "8");
	    gentext = gentext.replace(":px:", "9");

	    gentext = gentext.replace(":gl:", "[");
	    gentext = gentext.replace(":gm:", "=");
	    gentext = gentext.replace(":gf:", "=");
	    gentext = gentext.replace(":gr:", "]");
	    gentext = gentext.replace(":fl:", "=");
	    gentext = gentext.replace(":fr:", "=");
	    gentext = gentext.replace(":sl:", "{");
	    gentext = gentext.replace(":sm:", "=");
	    gentext = gentext.replace(":sr:", "}");

	    if(document.getElementById("whitespace").checked == false)
	    {
	    	gentext = gentext.replace(/^0+/, '');
	    }
	}
	document.getElementById("discordtext").value = gentext
}
function loadset()
{
	var loadtext = document.getElementById("discordtext").value;
	loadtext = loadtext.replace(/ /g,'');
	loadtext = loadtext.replace(/:panelheart:/g,':pr:');
	loadtext = loadtext.replace(/:panelsquare:/g,':po:');
	loadtext = loadtext.replace(/:panelstar:/g,':py:');
	loadtext = loadtext.replace(/:panelcircle:/g,':pg:');
	loadtext = loadtext.replace(/:paneltriangle:/g,':pc:');
	loadtext = loadtext.replace(/:paneldelta:/g,':pb:');
	loadtext = loadtext.replace(/:paneldiamond:/g,':pp:');
	loadtext = loadtext.replace(/:panelshock:/g,':ps:');
	loadtext = loadtext.replace(/:panelblank:/g,':px:');
	clearpanels();
	var children = document.getElementById('field').getElementsByTagName('img');
	//Detect type
	if(loadtext.includes(":"))
	{
		lines = loadtext.split("\n")
		for( var i = 0; i < lines.length; i++)
		{
			while(lines[i].length < 24)
			{
				lines[i] += ":xx:"
			}
		}
		loadtext = lines.join().replace(/,/g,"");
		loadtext = loadtext.replace(/ /g,"");
		for( var i = children.length-1; i>=0; i--)
		{
			children[i].src = "images/"+loadtext.substr(loadtext.length - 3, 2)+".png";
			loadtext = loadtext.substr(0,loadtext.length-4)
			if(loadtext.length == 0)
				i = -1;
		}
	}else
	{
		//document.getElementById("discordtext").value = "Detected PA"
		loadtext = loadtext.replace(/0/g, ":xx:");
		loadtext = loadtext.replace(/1/g, ":pr:");
		loadtext = loadtext.replace(/2/g, ":pg:");
		loadtext = loadtext.replace(/3/g, ":pc:");
		loadtext = loadtext.replace(/4/g, ":py:");
		loadtext = loadtext.replace(/5/g, ":pp:");
		loadtext = loadtext.replace(/6/g, ":pb:");
		loadtext = loadtext.replace(/7/g, ":po:");
		loadtext = loadtext.replace(/8/g, ":ps:");
		loadtext = loadtext.replace(/9/g, ":px:");
		for( var i = children.length-1; i>=0; i--)
		{
			children[i].src = "images/"+loadtext.substr(loadtext.length - 3, 2)+".png";
			loadtext = loadtext.substr(0,loadtext.length-4)
			if(loadtext.length == 0)
				i = -1;
		}
	}
}

function Vector(components)
{
    this.arr = components;
    this.row = components[0];
    this.column = components[1];
}
</script>