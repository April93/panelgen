<html>
<style>
body
{
	background-color: grey;
}
div
{
	width: 192px;
	border-style: double;
	border-color: #0000FF;
}
img
{
	width: 32px;
}
</style>
<center>
<body>
	<h1>Discord Panel Generator</h1>
	<div id="field">
		<img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=12 column="1"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=12 column="2"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=12 column="3"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=12 column="4"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=12 column="5"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=12 column="6"/><br>
		<img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=11 column="1"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=11 column="2"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=11 column="3"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=11 column="4"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=11 column="5"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=11 column="6"/><br>
		<img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=10 column="1"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=10 column="2"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=10 column="3"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=10 column="4"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=10 column="5"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=10 column="6"/><br>
		<img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=9 column="1"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=9 column="2"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=9 column="3"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=9 column="4"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=9 column="5"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=9 column="6"/><br>
		<img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=8 column="1"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=8 column="2"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=8 column="3"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=8 column="4"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=8 column="5"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=8 column="6"/><br>
		<img onclick="drawpanel(this)" ondragover="draw(this)" src="images/sl.png" row=7 column="1"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/sm.png" row=7 column="2"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/sm.png" row=7 column="3"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/sm.png" row=7 column="4"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/sm.png" row=7 column="5"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/sr.png" row=7 column="6"/><br>
		<img onclick="drawpanel(this)" ondragover="draw(this)" src="images/gl.png" row=6 column="1"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/gf.png" row=6 column="2"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/gr.png" row=6 column="3"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=6 column="4"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=6 column="5"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/xx.png" row=6 column="6"/><br>
		<img onclick="drawpanel(this)" ondragover="draw(this)" src="images/cr.png" row=5 column="1"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/cc.png" row=5 column="2"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/cg.png" row=5 column="3"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/cy.png" row=5 column="4"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/cp.png" row=5 column="5"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/cb.png" row=5 column="6"/><br>
		<img onclick="drawpanel(this)" ondragover="draw(this)" src="images/pr.png" row=4 column="1"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/pc.png" row=4 column="2"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/pg.png" row=4 column="3"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/py.png" row=4 column="4"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/pp.png" row=4 column="5"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/pb.png" row=4 column="6"/><br>
		<img onclick="drawpanel(this)" ondragover="draw(this)" src="images/pr.png" row=3 column="1"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/pc.png" row=3 column="2"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/pg.png" row=3 column="3"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/py.png" row=3 column="4"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/pp.png" row=3 column="5"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/pb.png" row=3 column="6"/><br>
		<img onclick="drawpanel(this)" ondragover="draw(this)" src="images/pr.png" row=2 column="1"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/pc.png" row=2 column="2"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/pg.png" row=2 column="3"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/py.png" row=2 column="4"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/pp.png" row=2 column="5"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/pb.png" row=2 column="6"/><br>
		<img onclick="drawpanel(this)" ondragover="draw(this)" src="images/pr.png" row=1 column="1"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/pc.png" row=1 column="2"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/pg.png" row=1 column="3"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/py.png" row=1 column="4"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/pp.png" row=1 column="5"/><img onclick="drawpanel(this)" ondragover="draw(this)" src="images/pb.png" row=1 column="6"/>
	</div>
	<br>
	<div id="tileset">
        <img onclick="selpanel(this)" src="images/gl.png" paneltype="combogarbage"/><img onclick="selpanel(this)" src="images/fl.png" paneltype="combogarbage"/><img onclick="selpanel(this)" src="images/fr.png" paneltype="combogarbage"/><img onclick="selpanel(this)" src="images/gm.png" paneltype="combogarbage"/><img onclick="selpanel(this)" src="images/gf.png" paneltype="combogarbage"/><img onclick="selpanel(this)" src="images/gr.png"  paneltype="combogarbage"/><br />
		<img onclick="selpanel(this)" src="images/sl.png" paneltype="combogarbage"/><img onclick="selpanel(this)" src="images/sm.png" paneltype="combogarbage"/><img onclick="selpanel(this)" src="images/sr.png" paneltype="chaingarbage"/><img onclick="selpanel(this)" src="images/gtl.png" paneltype="chaingarbage"/><img onclick="selpanel(this)" src="images/gts.png" paneltype="chaingarbage"/><img onclick="selpanel(this)" src="images/gtr.png" paneltype="chaingarbage"/><br />
		<img onclick="selpanel(this)" src="images/pr.png"/><img onclick="selpanel(this)" src="images/pc.png"/><img onclick="selpanel(this)" src="images/pg.png"/><img onclick="selpanel(this)" src="images/gls.png" paneltype="chaingarbage"/><img onclick="selpanel(this)" src="images/ge.png" paneltype="chaingarbage"/><img onclick="selpanel(this)" src="images/grs.png" paneltype="chaingarbage"/><br />
        <img onclick="selpanel(this)" src="images/py.png"/><img onclick="selpanel(this)" src="images/pp.png"/><img onclick="selpanel(this)" src="images/pb.png"/><img onclick="selpanel(this)" src="images/gbl.png" paneltype="chaingarbage"/><img onclick="selpanel(this)" src="images/gbs.png" paneltype="chaingarbage"/><img onclick="selpanel(this)" src="images/gbr.png" paneltype="chaingarbage"/><br />
		<img onclick="selpanel(this)" src="images/ps.png"/><img onclick="selpanel(this)" src="images/px.png"/><img onclick="selpanel(this)" src="images/po.png"/><img onclick="selpanel(this)" src="images/cr.png"/><img onclick="selpanel(this)" src="images/cc.png"/><img onclick="selpanel(this)" src="images/cg.png"/><br>
		<img onclick="selpanel(this)" src="images/xx.png"/><img onclick="selpanel(this)" src="images/xx.png"/><img onclick="selpanel(this)" src="images/co.png"/><img onclick="selpanel(this)" src="images/cy.png"/><img onclick="selpanel(this)" src="images/cp.png"/><img onclick="selpanel(this)" src="images/cb.png"/><br>
    </div>
	<br>
	Whitespace:<input type="checkbox" id="whitespace"><br>
	<button onclick="clearpanels()">Clear</button><button onclick="discord()">Discord</button>
	<br><button onclick="panelattack()">Panel Atack</button>
	<div>
		<textarea id="discordtext"></textarea>
	</div>
	<button onclick="loadset()">Load</button>
</body>
</center>
</html>
<script>
var selectedpanel = document.getElementById("tileset").firstElementChild
var lastImgBelowMouse

document.addEventListener('mousemove', updateElementBelowMouse)

function updateElementBelowMouse(event)
{
    var element = document.elementFromPoint(event.clientX, event.clientY);
    if (element.nodeName.toLowerCase() === 'img' && element.parentNode.getAttribute('id') === 'field')
    {
        lastImgBelowMouse = element
    }
}
function draw(img)
{
    var panelType = selectedpanel.getAttribute('panelType')
    if (!lastImgBelowMouse)
    {
        lastImgBelowMouse = img
    }
    if (panelType === "chaingarbage")
    {
        drawchaingarbage(img)
    }
    else if (panelType === "combogarbage")
    {
        drawcombogarbage(img)
    }
    else
    {
        drawpanel(img)
    }
}

// for the purpose of this tool this method does not consider 6x1 garbage chaingarbage but only garbage that takes up at least 2 rows
function drawchaingarbage(img)
{
    //get the coordinate from the panel we are on right now (lastImgBelowMouse)
    //calculate width + height of the garbage by doing a diff with the panel where we started dragging
    var anchor1X = Number(img.getAttribute('column'))
    var anchor1Y = Number(img.getAttribute('row'))
    console.log("anchor1 at " + anchor1Y + "|" + anchor1X);
    var anchor2X = Number(lastImgBelowMouse.getAttribute('column'))
    var anchor2Y = Number(lastImgBelowMouse.getAttribute('row'))
    console.log("anchor2 at " + anchor2Y + "|" + anchor2X);
    var garbageHeight = Math.abs(anchor1Y - anchor2Y) + 1
    var garbageWidth = Math.abs(anchor1X - anchor2X) + 1
    console.log("garbage dimensions are " + garbageWidth + "x" + garbageHeight);
    var topLeftAnchor = getTopLeftAnchorOfBox(anchor1X, anchor1Y, anchor2X, anchor2Y)
    var bottomRightAnchor = getBottomRightAnchorOfBox(topLeftAnchor, garbageWidth - 1, garbageHeight - 1)
    console.log("topLeftAnchor is " + topLeftAnchor.row + "|" + topLeftAnchor.column)
    console.log("bottomRightAnchor is " + bottomRightAnchor.row + "|" + bottomRightAnchor.column)

    // let's ignore the face for starters
    //var splitFaceHorizontally = garbageHeight % 2 === 0
    //var splitFaceVertically = garbageWidth % 2 === 0
    //var faceAnchor;
    //faceAnchor.X = topLeftAnchor.X - 0.5 + garbageWidth / 2.0;
    //faceAnchor.Y = topLeftAnchor + 0.5 + garbageHeight / 2.0;

    if (garbageHeight > 1) 
    {   // 4 corner tiles and onesided walls
        // by convention always draw rowwise from top left to bottom right
        for (var row = topLeftAnchor.row; row >= bottomRightAnchor.row; row--) 
        {
            // by convention always 6 wide because the current PA implementation does not support thinner bulk shapes
            for (var column = 1; column <= 6; column++) //for (var column = topLeftAnchor.column; column <= bottomRightAnchor.column; column++)
            {
                var element = document.querySelector("[row='" + row + "'][column='" + column + "']");
                console.log("About to draw element at " + row + "|" + column);
                if (row === topLeftAnchor.row)
                {
                    if (column === 1) // topLeftAnchor.column)
                    {   // draw top left corner tile
                        element.src = "images/gtl.png";
                    }
                    else if (column === 6) //bottomRightAnchor.column)
                    {   // draw top right corner tile
                        element.src = "images/gtr.png";
                    }
                    else
                    {   // draw top edge tile
                        element.src = "images/gts.png";
                    }
                }
                else if (row === bottomRightAnchor.row)
                {
                    if (column === 1) //topLeftAnchor.column)
                    {   // draw bottom left corner tile
                        element.src = "images/gbl.png";
                    }
                    else if (column === 6) //bottomRightAnchor.column)
                    {   // draw bottom right corner tile
                        element.src = "images/gbr.png";
                    }
                    else
                    {   // draw bottom edge tile
                        element.src = "images/gbs.png";
                    }
                }
                else
                {
                    if (column === 1) //topLeftAnchor.column)
                    {   // draw left edge tile
                        element.src = "images/gls.png";
                    }
                    else if (column === 6) //bottomRightAnchor.column)
                    {   // draw right edge tile
                        element.src = "images/grs.png";
                    }
                    else
                    {   // draw filler tile
                        element.src = "images/ge.png";
                    }
                }
            }
        }
    }
}

function drawcombogarbage(img)
{
    var metal = img.src.substr(8, 1) === "s"
    //get the coordinate from the panel we are on right now
    //calculate width + height of the garbage by doing a diff with the panel where we started dragging
    var anchor1X = Number(img.getAttribute('column'))
    var anchor1Y = Number(img.getAttribute('row'))
    console.log("anchor1 at " + anchor1Y + "|" + anchor1X);
    var anchor2X = Number(lastImgBelowMouse.getAttribute('column'))
    console.log("anchor2 at " + anchor1Y + "|" + anchor2X);
    var garbageWidth = Math.abs(anchor1X - anchor2X) + 1
    console.log("garbage dimensions are " + garbageWidth + "x1");
    var topLeftAnchor = getTopLeftAnchorOfBox(anchor1X, anchor1Y, anchor2X, anchor1Y)
    var bottomRightAnchor = getBottomRightAnchorOfBox(topLeftAnchor, garbageWidth - 1, 0)
    console.log("topLeftAnchor is " + topLeftAnchor.row + "|" + topLeftAnchor.column)
    console.log("bottomRightAnchor is " + bottomRightAnchor.row + "|" + bottomRightAnchor.column)

    var splitFaceVertically = garbageWidth % 2 === 0

    // 2 side tiles and twosided walls
    for (var column = topLeftAnchor.column; column <= bottomRightAnchor.column; column++)
    {
        console.log("About to draw element at " + topLeftAnchor.row + "|" + column);
        var element = document.querySelector("[row='"+topLeftAnchor.row+"'][column='"+column+"']");
        if (column === topLeftAnchor.column)
        {   // draw left side tile
            if (column === bottomRightAnchor.column)
            {   // 1x1 tile, draw 4-sided tile
                element.src = "images/gas.png";
            }
            else
            {
                element.src = metal ? "images/sl.png" : "images/gl.png";
            }
        }
        else if (column === bottomRightAnchor.column)
        {   // draw right side tile
            element.src = metal ? "images/sr.png" : "images/gr.png";
        }
        else
        {   // draw top/bottom edge tile
            if (splitFaceVertically && (1 + column - topLeftAnchor.column === garbageWidth / 2))
            {
                element.src = metal ? "images/sm.png" : "images/fl.png";
            }
            else if (splitFaceVertically && (column - topLeftAnchor.column === garbageWidth / 2))
            {
                element.src = metal ? "images/sm.png" : "images/fr.png";
            }
            else if (!splitFaceVertically && column - topLeftAnchor.column + 1 === (garbageWidth + 1) / 2)
            {
                element.src = metal ? "images/sm.png" : "images/gf.png";
            }
            else
            {
                element.src = metal ? "images/sm.png" : "images/gm.png";
            }
        }
    }
}

function getTopLeftAnchorOfBox(anchor1X, anchor1Y, anchor2X, anchor2Y)
{
    var topLeftAnchor = new Vector([0, 0]);

    topLeftAnchor.column = Math.min(anchor1X, anchor2X);
    topLeftAnchor.row = Math.max(anchor1Y, anchor2Y);

    return topLeftAnchor;
}
function getBottomRightAnchorOfBox(topLeftAnchor, width, height)
{
    return new Vector([topLeftAnchor.row - height, topLeftAnchor.column + width]);
}
function drawpanel(img)
{
    img.src = selectedpanel.src
}
function selpanel(img)
{
	selectedpanel = img
}
function clearpanels()
{
	var children = document.getElementById('field').getElementsByTagName('img');
	for( var i = 0; i<children.length; i++)
	{
		children[i].src = "images/xx.png"
	}
}
function discord()
{
	var gentext = ""
	var children = document.getElementById('field').getElementsByTagName('img');

	var linecount = 0;
	var line = ""
	for( var i = 0; i<children.length; i++)
	{
        var imageNameStart = children[i].src.lastIndexOf("/") + 1;
        var imageNameEnd = children[i].src.lastIndexOf(".");
        var nameLength = imageNameEnd - imageNameStart;
	    line += ":"+children[i].src.substr(imageNameStart, nameLength) +":"
	    linecount += 1;
	    if(linecount >= 6)
	    {
	    	linecount = 0;

	    	if(document.getElementById("whitespace").checked == false)
	    	{
	    		while(line.substr(line.length - 4, 4) == ":xx:")
	    		{
	    			line = line.substr(0,line.length-4)
	    		}
	    	}
	    	if(line.length != 0 && i <= 66)
	    		line += "\n"
	    	gentext += line
	    	line = ""
		}
	}
	document.getElementById("discordtext").value = gentext
}
function panelattack()
{
/*
0 = empty
1 = red
2 = green
3 = light blue
4 = yellow
5 = purple
6 = dark blue
7 = orange (not really used in the game so far, but it exists)
8 = exclamation block [!]
9 = block with no color (dark grey, doesn't match with anything)
[] = garbage start / end
{} = metal garbage start / end
= = placeholder inside of garbage
*/
	var gentext = ""
	var children = document.getElementById('field').getElementsByTagName('img');
	for( var i = 0; i<children.length; i++)
	{
	    gentext += ":"+children[i].src.substr(children[i].src.length - 6, 2)+":"
	    gentext = gentext.replace(":xx:", "0");
	    gentext = gentext.replace(":pr:", "1");
	    gentext = gentext.replace(":cr:", "1");
	    gentext = gentext.replace(":pg:", "2");
	    gentext = gentext.replace(":cg:", "2");
	    gentext = gentext.replace(":pc:", "3");
	    gentext = gentext.replace(":cc:", "3");
	    gentext = gentext.replace(":py:", "4");
	    gentext = gentext.replace(":cy:", "4");
	    gentext = gentext.replace(":pp:", "5");
	    gentext = gentext.replace(":cp:", "5");
	    gentext = gentext.replace(":pb:", "6");
	    gentext = gentext.replace(":cb:", "6");
	    gentext = gentext.replace(":po:", "7");
	    gentext = gentext.replace(":co:", "7");
	    gentext = gentext.replace(":ps:", "8");
	    gentext = gentext.replace(":px:", "9");

	    gentext = gentext.replace(":gl:", "[");
        gentext = gentext.replace(":gtl:", "[");
        gentext = gentext.replace(":gtr:", "=");
        gentext = gentext.replace(":gbl:", "=");
        gentext = gentext.replace(":gls:", "=");
        gentext = gentext.replace(":grs:", "=");
        gentext = gentext.replace(":gts:", "=");
        gentext = gentext.replace(":gbs:", "=");
        gentext = gentext.replace(":gls:", "=");
        gentext = gentext.replace(":ge:", "=");
	    gentext = gentext.replace(":gm:", "=");
	    gentext = gentext.replace(":gf:", "=");
        gentext = gentext.replace(":fl:", "=");
	    gentext = gentext.replace(":fr:", "=");
        gentext = gentext.replace(":gbr:", "]");
	    gentext = gentext.replace(":gr:", "]");
	    
	    gentext = gentext.replace(":sl:", "{");
	    gentext = gentext.replace(":sm:", "=");
	    gentext = gentext.replace(":sr:", "}");

	    if(document.getElementById("whitespace").checked == false)
	    {
	    	gentext = gentext.replace(/^0+/, '');
	    }
	}
	document.getElementById("discordtext").value = gentext
}
function loadset()
{
	var loadtext = document.getElementById("discordtext").value;
	loadtext = loadtext.replace(/ /g,'');
	loadtext = loadtext.replace(/:panelheart:/g,':pr:');
	loadtext = loadtext.replace(/:panelsquare:/g,':po:');
	loadtext = loadtext.replace(/:panelstar:/g,':py:');
	loadtext = loadtext.replace(/:panelcircle:/g,':pg:');
	loadtext = loadtext.replace(/:paneltriangle:/g,':pc:');
	loadtext = loadtext.replace(/:paneldelta:/g,':pb:');
	loadtext = loadtext.replace(/:paneldiamond:/g,':pp:');
	loadtext = loadtext.replace(/:panelshock:/g,':ps:');
	loadtext = loadtext.replace(/:panelblank:/g,':px:');
	clearpanels();
	var children = document.getElementById('field').getElementsByTagName('img');
	//Detect type
	if(loadtext.includes(":"))
	{
		lines = loadtext.split("\n")
		for( var i = 0; i < lines.length; i++)
		{
            // make sure each row has 6 panels if less were entered to form a valid puzzle string
			while(lines[i].split(":").length < 13)
			{
				lines[i] += ":xx:"
			}
		}
        // stitch the rows back together into the puzzle string and delete whitespace
		loadtext = lines.join().replace(/,/g,"");
		loadtext = loadtext.replace(/ /g,"");
        var textArray = loadtext.split("::");
        textArray.forEach(function(item, i) { textArray[i] = textArray[i].replace(":", "") })
        var j = 1
		for( var i = children.length-1; i>=0; i--)
		{
			children[i].src = "images/" + textArray[textArray.length - j] + ".png";
			if(j == textArray.length)
				i = -1;
            j++;
		}
	}else
	{
		//document.getElementById("discordtext").value = "Detected PA"
        var textArray = Array.from(loadtext);
        textArray = loadReplaceGarbage(textArray, true);
        textArray = loadReplaceGarbage(textArray, false);
        textArray.forEach(function(entry, i) { if (entry == 0) textArray[i] = "xx"});
        textArray.forEach(function(entry, i) { if (entry == 1) textArray[i] = "pr"});
        textArray.forEach(function(entry, i) { if (entry == 2) textArray[i] = "pg"});
        textArray.forEach(function(entry, i) { if (entry == 3) textArray[i] = "pc"});
        textArray.forEach(function(entry, i) { if (entry == 4) textArray[i] = "py"});
        textArray.forEach(function(entry, i) { if (entry == 5) textArray[i] = "pp"});
        textArray.forEach(function(entry, i) { if (entry == 6) textArray[i] = "pb"});
        textArray.forEach(function(entry, i) { if (entry == 7) textArray[i] = "po"});
        textArray.forEach(function(entry, i) { if (entry == 8) textArray[i] = "ps"});
        textArray.forEach(function(entry, i) { if (entry == 9) textArray[i] = "px"});
        
        
        var j = 1
		for( var i = children.length-1; i>=0; i--)
		{
			children[i].src = "images/" + textArray[textArray.length - j] +".png";
			if(j === textArray.length)
				i = -1;
            j++;
		}
	}
}

function loadReplaceGarbage(textArray, metal)
{
    var garbageStartCharacter = (metal) ? "{" : "[";
    var garbageEndCharacter = (metal) ? "}" : "]";

    var garbageStartIndex = textArray.indexOf(garbageStartCharacter);
    while (garbageStartIndex != -1) 
    {
        var garbageEndIndex = textArray.indexOf(garbageEndCharacter);
        if (garbageEndIndex - garbageStartIndex > 5) 
        {
            textArray[garbageStartIndex] = "gtl";
            textArray[garbageEndIndex] = "gbr";
            for (let index = garbageStartIndex; index < garbageEndIndex; index++)
            {
                if (textArray[index] === "=")
                {
                    if (index - garbageStartIndex < 5)
                    {
                        textArray[index] = "gts";
                    }
                    else if (index - garbageStartIndex === 5) 
                    {
                        textArray[index] = "gtr";
                    }
                    else if (garbageEndIndex - index <= 6 )
                    {
                        if (garbageEndIndex - index === 5)
                        {
                            textArray[index] = "gbl";
                        }
                        else {
                            textArray[index] = "gbs";
                        }
                    }
                    else 
                    {
                        if ((index - garbageStartIndex) % 6 === 0)
                        {
                            textArray[index] = "gls";
                        }
                        else if ((garbageEndIndex - index) % 6 === 0)
                        {
                            textArray[index] = "grs";
                        }
                        else
                        {
                            textArray[index] = "ge";
                        }
                    }
                }
            }
        }
        else
        {
            textArray[garbageStartIndex] = metal ? "sl" : "gl";
            textArray[garbageEndIndex] = metal ? "sr" : "gr";
            if (!metal && (garbageEndIndex - garbageStartIndex) % 2 > 0)
            {   //split face
                textArray[(garbageStartIndex + garbageEndIndex) / 2 - 0.5] = "fl";
                textArray[(garbageStartIndex + garbageEndIndex) / 2 + 0.5] = "fr";
            }
            else if (!metal && (garbageEndIndex - garbageStartIndex) % 2 === 0)
            {   //unsplit face
                textArray[(garbageStartIndex + garbageEndIndex) / 2] = "gf";
            }

            for (let index = garbageStartIndex; index < garbageEndIndex; index++)
            {
                if (textArray[index] === "=")
                {
                    textArray[index] = metal ? "sm" : "gm";
                }
            }
        }

        garbageStartIndex = textArray.indexOf(garbageStartCharacter);
    }

    return textArray;
}

function Vector(components)
{
    this.arr = components;
    this.row = components[0];
    this.column = components[1];
}
</script>